"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const p=require("mini"),a=require("mini/store");function f(n,o={nohistory:!1,replacehistory:!1}){n!==a("$url").value&&(a("$url").value=n,o.nohistory||(o.replacehistory?window.history.pushState({},null,n):window.history.replaceState({},null,n)))}function h(){return a("$route")}async function m({routes:n,loader:o=!1,handleAuth:l}){if(!a("$route")){let i=function(e){e.preventDefault(),e.stopPropagation();const s=window.location.href.replace(window.location.origin,"");f(s,!0)};console.log(">>INIT Router<<"),a("$url",p.reactive(window.location.href.replace(window.location.origin,""))),window.addEventListener("popstate",i)}let t=g(decodeURIComponent(a("$url").value),n),r=!0;if(!(l&&(r=await l(t),!r)))return a("$route",t),o?p.Suspense(a("$route").element,o):()=>p.html`${a("$route").element}`}function d(n,o){const l=n.split("/").map((u,c)=>[u.replace(":",""),c,u.charAt(0)===":"]),t=l.filter(([,,u])=>u),r=l.filter(([,,u])=>!u),i=o.split("/"),e=t.map(([u,c])=>[u,i[c]]);let s=!0;return r.forEach(([u,c])=>s=s&u===i[c]),s?Object.fromEntries(e):null}function w(n,o){const l=i=>i.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),t=new RegExp("^"+n.split("*").map(l).join("(.*)")+"$"),r=o.match(t);return r&&r[1]!==null?"/"+r[1]:null}function g(n,o){return R(n,null,o)}function R(n,o,l){let t=n||"/";t&&t!=="/"&&t.slice(-1)==="/"&&(t=t.slice(0,-1));let r=t.split("?")[1];r&&(r=new URLSearchParams(r),r=Object.fromEntries([...r]),t=t.split("?")[0]);const i=l?.find(e=>{if(e.path!=="/"&&e.path.slice(-1)==="/"&&(e.path=e.path.slice(0,-1)),e.path===t||e.path.includes("*")&&(t===e.path.slice(0,-2)?e.subpath="/":e.subpath=w(e.path,t),e.subpath))return!0;if(e.path.includes(":")){const s=d(e.path,t);return s?(e.params=s,!0):!1}return!1});return i?(i.url=t,i.query=r,i):!1}exports.Router=m;exports.getRoute=h;exports.setRoute=f;
