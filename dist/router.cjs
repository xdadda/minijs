"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const p=require("mini"),l=require("mini/store");function f(n,i={nohistory:!1,replacehistory:!1}){n!==l("$url").value&&(l("$url").value=n,i.nohistory||(i.replacehistory?window.history.pushState({},null,n):window.history.replaceState({},null,n)))}function h(){return l("$route")}async function m({routes:n,loader:i=!1,handleAuth:a}){if(!l("$route")){let o=function(e){e.preventDefault(),e.stopPropagation();const s=window.location.href.replace(window.location.origin,"");f(s,!0)};l("$url",p.reactive(window.location.href.replace(window.location.origin,""))),window.addEventListener("popstate",o)}let t=g(decodeURIComponent(l("$url").value),n),r=!0;if(!(a&&(r=await a(t),!r)))return l("$route",t),i?p.Suspense(l("$route").element,i):()=>p.html`${l("$route").element}`}function d(n,i){const a=n.split("/").map((u,c)=>[u.replace(":",""),c,u.charAt(0)===":"]),t=a.filter(([,,u])=>u),r=a.filter(([,,u])=>!u),o=i.split("/"),e=t.map(([u,c])=>[u,o[c]]);let s=!0;return r.forEach(([u,c])=>s=s&u===o[c]),s?Object.fromEntries(e):null}function w(n,i){const a=o=>o.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),t=new RegExp("^"+n.split("*").map(a).join("(.*)")+"$"),r=i.match(t);return r&&r[1]!==null?"/"+r[1]:null}function g(n,i){return R(n,null,i)}function R(n,i,a){let t=n||"/";t&&t!=="/"&&t.slice(-1)==="/"&&(t=t.slice(0,-1));let r=t.split("?")[1];r&&(r=new URLSearchParams(r),r=Object.fromEntries([...r]),t=t.split("?")[0]);const o=a?.find(e=>{if(e.path!=="/"&&e.path.slice(-1)==="/"&&(e.path=e.path.slice(0,-1)),e.path===t||e.path.includes("*")&&(t===e.path.slice(0,-2)?e.subpath="/":e.subpath=w(e.path,t),e.subpath))return!0;if(e.path.includes(":")){const s=d(e.path,t);return s?(e.params=s,!0):!1}return!1});return o?(o.url=t,o.query=r,o):!1}exports.Router=m;exports.getRoute=h;exports.setRoute=f;
